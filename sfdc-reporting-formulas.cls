/*
Table of Contents

-Day of Quarter Case Created - Based on Feb-Jan FY
-Day of Quarter Case Closed - Based on Feb-Jan FY

*/

/*
*********************************
***Day of Quarter Case Created***
*********************************
*/

/* Identify number of days in the quarter. This accounts for a Feb-Jan fiscal year and takes into account leap years*/
CASE(
    MONTH ( DATEVALUE(CREATED_DATEONLY) ),
    1, 91,
    2, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    3, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    4, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    5, 91,
    6, 91,
    7, 91,
    8, 91,
    9, 91,
    10, 91,
    11, 91,
    12, 91,
    NULL
    )
 -
/* Set the end date of the quarter for each month. This use case has a Feb to Jan fiscal, so Nov and Dec have to look ahead +1 year for their end date. */
(CASE(
    MONTH ( DATEVALUE(CREATED_DATEONLY) ),
    2, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 04,30),
    3, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 04,30),
    4, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 04,30),
    5, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 07,31),
    6, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 07,31),
    7, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 07,31),
    8, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 10,31),
    9, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 10,31),
    10, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 10,31),
    11, DATE(YEAR(DATEVALUE(CREATED_DATEONLY))+1, 01,31),
    12, DATE(YEAR(DATEVALUE(CREATED_DATEONLY))+1, 01,31),
    1, DATE(YEAR(DATEVALUE(CREATED_DATEONLY)), 01,31),
    NULL
    )

-

DATEVALUE(CREATED_DATEONLY) )


/*
*********************************
***Day of Quarter Case Closed****
*********************************
*/

CASE(
    MONTH ( DATEVALUE(CLOSED_DATEONLY) ),
    1, 91,
    2, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    3, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    4, IF(OR(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 400 ) = 0,AND(MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 4 ) = 0,MOD( YEAR( DATEVALUE(CREATED_DATEONLY) ), 100 ) != 0)),90,89),
    5, 91,
    6, 91,
    7, 91,
    8, 91,
    9, 91,
    10, 91,
    11, 91,
    12, 91,
    NULL
    )
 -
(CASE(
    MONTH ( DATEVALUE(CLOSED_DATEONLY) ),
    2, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 04,30),
    3, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 04,30),
    4, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 04,30),
    5, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 07,31),
    6, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 07,31),
    7, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 07,31),
    8, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 10,31),
    9, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 10,31),
    10, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 10,31),
    11, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY))+1, 01,31),
    12, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY))+1, 01,31),
    1, DATE(YEAR(DATEVALUE(CLOSED_DATEONLY)), 01,31),
    NULL
    )

-

DATEVALUE(CLOSED_DATEONLY) )